<Window x:Class="TrainingTracker.ExperimentApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Эксперимент по планам тренировок"
        Height="640"
        Width="1150"
        MinHeight="560"
        MinWidth="1000"
        Background="#F3F6FB"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">

    <Window.Resources>
        <SolidColorBrush x:Key="CardBrush" Color="White"/>
        <SolidColorBrush x:Key="PrimaryBrush" Color="#3D6DEB"/>
        <SolidColorBrush x:Key="MutedBrush" Color="#5C667A"/>

        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#3D6DEB"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="8,4"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#1F000000" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Border" x:Key="CardStyle">
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="22"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#0D000000" BlurRadius="18" ShadowDepth="3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TextBlock" x:Key="SectionLabel">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource MutedBrush}"/>
            <Setter Property="Margin" Value="0,12,0,4"/>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="28">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Margin="0,0,0,18">
                <TextBlock Text="Сравнение тренировочных планов" FontSize="26" FontWeight="Bold" Foreground="#1F2A44"/>
                <TextBlock Text="Настройте параметры Монте-Карло и найдите оптимальную стратегию."
                           Foreground="{StaticResource MutedBrush}"
                           Margin="0,4,0,0"/>
            </StackPanel>

            <Grid Grid.Row="1" Margin="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="360"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="Параметры эксперимента" FontSize="20" FontWeight="Bold"/>
                        <TextBlock Text="Укажите горизонты моделирования и выберите сценарии"
                                   Foreground="{StaticResource MutedBrush}"
                                   Margin="0,4,0,12"/>

                        <TextBlock Text="Количество недель" Style="{StaticResource SectionLabel}"/>
                        <TextBox x:Name="WeeksTextBox" Text="8" Height="34"/>

                        <TextBlock Text="Тренировок в неделю" Style="{StaticResource SectionLabel}"/>
                        <TextBox x:Name="SessionsTextBox" Text="4" Height="34"/>

                        <TextBlock Text="Прогонов Монте-Карло" Style="{StaticResource SectionLabel}"/>
                        <TextBox x:Name="RunsTextBox" Text="300" Height="34"/>

                        <TextBlock Text="Активные планы" Style="{StaticResource SectionLabel}" Margin="0,16,0,4"/>
                        <Border Background="#F3F6FF" CornerRadius="10" Padding="12">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Height="160">
                                <ItemsControl x:Name="PlanList" ItemsSource="{Binding PlanOptions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding Plan.Name}"
                                                      IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                      Margin="0,4"
                                                      FontWeight="SemiBold"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                            <Button x:Name="RunButton"
                                    Content="Запустить эксперимент"
                                    Height="42"
                                    Width="200"
                                    Click="OnRunExperimentClick"/>
                            <Button x:Name="ExportButton"
                                    Content="Экспорт результатов"
                                    Height="42"
                                    Width="200"
                                    Margin="12,0,0,0"
                                    Click="OnExportResultsClick"
                                    Style="{StaticResource {x:Type Button}}"/>
                        </StackPanel>

                        <TextBlock x:Name="StatusTextBlock"
                                   Margin="0,10,0,0"
                                   Foreground="{StaticResource MutedBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="24,0,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <WrapPanel Grid.Row="0" Margin="0,0,0,16" ItemWidth="220">
                            <Border Background="#EEF2FF" CornerRadius="10" Padding="12" Margin="4">
                                <StackPanel>
                                    <TextBlock Text="Горизонт" Foreground="{StaticResource MutedBrush}" FontSize="12"/>
                                    <TextBlock Text="{Binding ElementName=WeeksTextBox, Path=Text, FallbackValue='—'}"
                                               FontWeight="Bold" FontSize="20"/>
                                </StackPanel>
                            </Border>
                            <Border Background="#EEF2FF" CornerRadius="10" Padding="12" Margin="4">
                                <StackPanel>
                                    <TextBlock Text="Тренировок/нед" Foreground="{StaticResource MutedBrush}" FontSize="12"/>
                                    <TextBlock Text="{Binding ElementName=SessionsTextBox, Path=Text, FallbackValue='—'}"
                                               FontWeight="Bold" FontSize="20"/>
                                </StackPanel>
                            </Border>
                            <Border Background="#EEF2FF" CornerRadius="10" Padding="12" Margin="4">
                                <StackPanel>
                                    <TextBlock Text="Прогонов" Foreground="{StaticResource MutedBrush}" FontSize="12"/>
                                    <TextBlock Text="{Binding ElementName=RunsTextBox, Path=Text, FallbackValue='—'}"
                                               FontWeight="Bold" FontSize="20"/>
                                </StackPanel>
                            </Border>
                        </WrapPanel>

                        <DataGrid x:Name="ResultsGrid"
                                  Grid.Row="1"
                                  Height="360"
                                  ItemsSource="{Binding Results}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Margin="0,0,0,14"
                                  RowBackground="#F8FAFF"
                                  AlternatingRowBackground="White"
                                  GridLinesVisibility="None"
                                  BorderThickness="0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="План" Binding="{Binding PlanName}" Width="200"/>
                                <DataGridTextColumn Header="Средняя форма" Binding="{Binding AverageFitness, StringFormat=F1}" Width="160"/>
                                <DataGridTextColumn Header="95% форма" Binding="{Binding FitnessPercentile95, StringFormat=F1}" Width="150"/>
                                <DataGridTextColumn Header="Вероятность выгорания" Binding="{Binding BurnoutProbability, StringFormat=P1}" Width="200"/>
                                <DataGridTextColumn Header="Стабильность" Binding="{Binding Stability, StringFormat=F2}" Width="140"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Grid.Row="2" Margin="0,10,0,0">
                            <Border Background="#EEF2FF" CornerRadius="10" Padding="14">
                                <TextBlock Text="Стабильность показывает долю дней, когда форма превышала усталость. Значение ближе к 1 означает ровный прогресс."
                                           Foreground="{StaticResource MutedBrush}"
                                           TextWrapping="Wrap"/>
                            </Border>
                            <Border Background="#FFFFFF" CornerRadius="10" Padding="14" Margin="0,10,0,0">
                                <TextBlock Text="Итоги"
                                           FontWeight="Bold"
                                           FontSize="16"/>
                                <TextBlock x:Name="SummaryTextBlock"
                                           Margin="0,6,0,0"
                                           TextWrapping="Wrap"
                                           Foreground="{StaticResource MutedBrush}"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</Window>